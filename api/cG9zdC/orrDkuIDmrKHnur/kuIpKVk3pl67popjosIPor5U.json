{"title":"记一次线上JVM问题调试","date":"2019-02-27T03:21:32.000Z","slug":"记一次线上JVM问题调试","comments":true,"tags":["JVM问题调试"],"categories":["JVM"],"updated":"2019-02-27T04:24:46.202Z","content":"<h3 id=\"发现java进程\">发现java进程<a href=\"post/记一次线上JVM问题调试#发现java进程\"></a></h3><ul>\n<li>使用linux命令：ps</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep prcessName</span><br><span class=\"line\">[root@YZSJHL81-35 ~]# ps -ef | grep Bootstrap</span><br><span class=\"line\">root     118271      1 99 00:10 ?        3-16:08:07  Bootstrap start</span><br><span class=\"line\">root     197682 197016  0 17:08 pts/0    00:00:00 grep Bootstrap</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用java自带的检测工具 jps</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@YZSJHL81-35 ~]# jps</span><br><span class=\"line\">118271 Bootstrap</span><br><span class=\"line\">197101 Jps</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<ul>\n<li><p>检测java进程启动的时间</p>\n<p>  ps -p 118271 -o etime<br>  ps -p 118271 -o etime=</p>\n</li>\n<li><p>检测进程打开的文件数</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -n -p 118271 | wc -l</span><br></pre></td></tr></table></figure>\n<h3 id=\"检测系统的进程\">检测系统的进程<a href=\"post/记一次线上JVM问题调试#检测系统的进程\"></a></h3><ul>\n<li><p>top</p>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top - 17:11:21 up 132 days,  2:14,  1 user,  load average: 0.12, 0.21, 0.18</span><br><span class=\"line\">Tasks: 298 total,   1 running, 297 sleeping,   0 stopped,   0 zombie</span><br><span class=\"line\">Cpu(s):  1.0%us,  0.6%sy,  0.0%ni, 98.0%id,  0.3%wa,  0.0%hi,  0.1%si,  0.0%st</span><br><span class=\"line\">Mem:  99009860k total, 90554384k used,  8455476k free,   333672k buffers</span><br><span class=\"line\">Swap:        0k total,        0k used,        0k free, 81820024k cached</span><br><span class=\"line\"></span><br><span class=\"line\">PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</span><br><span class=\"line\"></span><br><span class=\"line\">q-退出</span><br><span class=\"line\">1-显示所有的cpu及其状态</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看指定进程下所有线程的状态</p>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top -Hp pid</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"查看JVM的GC状态\">查看JVM的GC状态<a href=\"post/记一次线上JVM问题调试#查看JVM的GC状态\"></a></h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jstat -gcutil -t pid 1000 100 ---查看pid进程的GC状态每隔1000ms一次，一共100次</span><br></pre></td></tr></table></figure>\n<p>​    </p>\n<h3 id=\"查看JVM栈信息\">查看JVM栈信息<a href=\"post/记一次线上JVM问题调试#查看JVM栈信息\"></a></h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">printf '%x\\n' tid -- 打印指定线程id的十六进制表示</span><br><span class=\"line\">jstack pid | grep 'tid十六进制' -C20 -color  -- 查看进程的栈信息</span><br><span class=\"line\">jmap -histo:live pid --查看进程所有存活的实例</span><br><span class=\"line\">jmap -dumap:format=b,file=dump.hprof pid --导出JVM的dump文件</span><br></pre></td></tr></table></figure>","next":{"title":"辨析 Sass 中的 Map 和 List","slug":"demo"},"link":"https://shang.at/post/记一次线上JVM问题调试/"}